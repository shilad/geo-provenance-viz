<!doctype html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang=""> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8" lang=""> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9" lang=""> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang=""> <!--<![endif]-->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title></title>

    <meta name="description" content="What country publishes the information on a particular webpage? This page demonstrates a geoprovenance inference algorithm." />

    <!-- Schema.org markup for Google+ -->
    <meta itemprop="name" content="Inferring a webpage's geoprovenance">
    <meta itemprop="description" content="What country publishes the information on a particular webpage? This page demonstrates a geoprovenance inference algorithm.">

    <meta itemprop="image" content="http://www.shilad.com/localness/img/demo-preview.png">

    <!-- Twitter Card data -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@shiladsen">
    <meta name="twitter:title" content="Inferring a webpage's geoprovenance">
    <meta name="twitter:description" content="What country publishes the information on a particular webpage? This page demonstrates a geoprovenance inference algorithm.">
    <meta name="twitter:creator" content="@shiladsen">

    <meta name="twitter:image" content="http://www.shilad.com/localness/img/demo-preview.png">
    <meta name="twitter:url" content="http://www.shilad.com/localness/demo.html">

    <!-- Open Graph data -->
    <meta property="og:title" content="Inferring a webpage's geoprovenance" />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="http://www.shilad.com/localness/demo.html" />
    <meta property="og:image" content="http://www.shilad.com/localness/img/demo-preview.png" />
    <meta property="og:description" content="What country publishes the information on a particular webpage? This page demonstrates a geoprovenance inference algorithm." />
    <meta property="og:site_name" content="Geoprovenance" />
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="apple-touch-icon" href="apple-touch-icon.png">

    <link rel="stylesheet" href="css/bootstrap.min.css">
    <style>
        body {
            padding-top: 0;
            padding-bottom: 15px;
        }
    </style>
    <link rel="stylesheet" href="css/bootstrap-theme.min.css">
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="css/bootstrap-social.css">
    <link rel="stylesheet" href="js/vendor/jquery-jvectormap-2.0.2.css">
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/demo.css">

    <script src="js/vendor/modernizr-2.8.3-respond-1.4.2.min.js"></script>
</head>
<body>
<!--[if lt IE 8]>
<p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
<![endif]-->


<div class="container popout"><a href="#" target="_blank">Open in new window.</a></div>

<div class="loading-dialog" class="modal fade">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title">Loading data files...</h4>
            </div>
            <div class="modal-body">
                <div class="progress">
                    <div caption="languages" class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="min-width: 10em;">
                        languages 0%
                    </div>
                </div>
                <div class="progress">
                    <div caption="wikidata" class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="min-width: 10em;">
                        wikidata 0%
                    </div>
                </div>
                <div class="progress">
                    <div caption="country aliases" class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="min-width: 10em;">
                        country aliases 0%
                    </div>
                </div>
                <div class="progress">
                    <div caption="country info" class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="min-width: 10em;">
                        country info 0%
                    </div>
                </div>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->


<!-- Main jumbotron for a primary marketing message or call to action -->
<div class="container">

    <nav class="navbar navbar-inverse navbar-static-top" role="navigation">
        <div class="container-fluid">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <!--<a class="navbar-brand" class="active" href="index.html">Geoprovenance</a>-->
            </div>
            <div id="navbar" class="navbar-collapse collapse">
                <ul class="nav navbar-nav">
                    <li role="presentation"><a href="index.html">Home</a></li>
                    <li role="presentation" class="active"><a href="demo.html">Inference alg</a></li>
                    <li role="presentation"><a href="source_localness.html">Localness viz</a></li>
                    <li role="presentation"><a href="source_geoprovenance.html">Geoprovenance viz</a></li>
                    <li role="presentation"><a href="geoprovenance_CHI2015.pdf">Paper</a></li>
                    <li role="presentation" class="share-icons">
                        <a href="http://twitter.com/share?url=URL&hashtags=geoprovenance"
                           class="btn btn-social-icon btn-twitter fancy-share">
                            <i class="fa fa-twitter"></i></a>
                        <a href="https://www.facebook.com/sharer/sharer.php?u=URL"
                           class="btn btn-social-icon btn-facebook fancy-share">
                            <i class="fa fa-facebook"></i></a>
                        <a href="https://plus.google.com/share?url=URL"
                           class="btn btn-social-icon btn-google-plus fancy-share">
                            <i class="fa fa-google-plus"></i></a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="row">
        <h1 class="col-md-12">Geoprovenance Inference Algorithm</h1>
        <p class="col-md-12">
            This page guesses the country that is primarily responsible for the information on a web page using a
            <b>geoprovenance inference algorithm</b>.
            The publisher of each URL that you input in the search box below is geolocated by querying the domain contact from a whois search,
            by looking up the headquarters of the company on Wikidata and using the domain suffix (e.g. '.uk') as well as
            three other algorithms to determine where the domain is from.
            When combined, these six different methods achieve 91% accuracy.
        </p>
        <p class="col-md-12">
            Details can be found in our paper, and reference implementations in Python and Javascript are available in our <a href="https://github.com/shilad/geo-provenance/">GitHub Repo</a>.
            <em>Shilad Sen, Heather Ford, Dave Musicant, Mark Graham, Oliver Keyes, and Brent Hecht. 2015. <a href="http://www-users.cs.umn.edu/~bhecht/publications/localnessgeography_CHI2015.pdf">Barriers to the Localness of Volunteered Geographic Information.</a> Proceedings of CHI 2015. New York: ACM Press.</em>
            (** Note that this page shows a simplified algorithm with lower accuracy than the version we used in our paper.)
        </p>
        <p class="col-md-12">

        </p>
        <div class="col-md-7">
            <p>
                Enter a URL below or click a suggested URL to see our algorithm in action.
            </p>

            <div class="queryform">
                <div class="input-group">
                    <form>
                        <input type="text" class="form-control" placeholder="http://www.bbc.com/news/world-latin-america-32261550">
                    </form>
                        <span class="input-group-btn">
                            <button class="btn btn-default" type="button">Go!</button>
                        </span>
                </div><!-- /input-group -->
            </div>
        </div>
        <div class="col-md-5 try">
            Try these suggested URLs:<br/>
            <ul class="try">
                <li><a href="#" class="example">http://d-nb.info/gnd/10001229-2</a></li>
                <li><a href="#" class="example">http://www.bouchard-pereetfils.com/en/village.html</a></li>
                <li><a href="#" class="example">http://whc.unesco.org/en/list/1293</a></li>
            </ul>
        </div>
    </div>

    <div class="row mainrow">
        <div class="map-container col-md-6">
        </div>

        <div class="col-md-6 alg alg-final">
            <h2>Main algorithm:&nbsp;&nbsp;<small class="text-right">(91% accuracy)</small></h2>
            <p>Combines the six other methods shown on this page.</p>
          <pre class="output">
              </pre>
        </div>

    </div>
</div>

<div class="container">
    <!-- Example row of columns -->
    <div class="row">
        <h2 class="col-md-12">Component algorithms:</h2>
        <div class="row">
            <div class="col-md-4 alg alg-lang">
                <h4>Language algorithm:&nbsp;&nbsp;<small class="text-right">(61% accuracy)</small></h4>
                <p>Detects the language of a webpage and looks up the countries most likely to speak it.</p>
                <pre class="output"></pre>
            </div>
            <div class="col-md-4 alg alg-whois">
                <h4>WhoIs algorithm:&nbsp;&nbsp;<small class="text-right">(80% accuracy)</small></h4>
                <p>Performs a <a href="https://en.wikipedia.org/wiki/Whois">WhoIs query</a> to obtain the contact address associated with the web domain.</p>
                <pre class="output"></pre>
            </div>
            <div class="col-md-4 alg alg-prior">
                <h4>Prior algorithm:&nbsp;&nbsp;<small class="text-right">(30% accuracy)</small></h4>
                <p>Represents the overall likelihood of a country to produce sources.</p>
                <pre class="output"></pre>
            </div>
        </div>
        <div class="col-md-4 alg alg-wikidata">
            <h4>Wikidata algorithm:&nbsp;&nbsp;<small class="text-right">(93% accuracy)</small></h4>
            <p>Looks up the headquarters country for organizations present in <a href="https://www.wikidata.org/wiki/Q1141571">Wikidata</a>.</p>
            <pre class="output"></pre>
        </div>
        <div class="col-md-4 alg alg-tld">
            <h4>TLD algorithm:&nbsp;&nbsp;<small class="text-right">(98% accuracy)</small></h4>
            <p>Identifies the country associated with URLs top-level-domains (TLDs) such as .uk, .de, and .cn.</p>
            <pre class="output"></pre>
        </div>
        <div class="col-md-4 alg alg-ip">
            <h4>GeoIP algorithm:&nbsp;&nbsp;<small class="text-right">(45% accuracy)</small></h4>
            <p>Geocodes the web server's IP address.</p>
            <pre class="output"></pre>
        </div>

    </div>

    <hr>

    <footer>
        <p>For questions, contact <a href="http://shilad.com">Shilad Sen</a></p>
    </footer>
</div> <!-- /container -->        <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="js/vendor/jquery-2.1.3.min.js"><\/script>')</script>

<script src="js/vendor/bootstrap.min.js"></script>
<script src="js/vendor/jquery-jvectormap-2.0.2.min.js"></script>
<script src="js/vendor/jquery-jvectormap-world-mill-en.js"></script>
<script src="js/vendor/jquery.scrollTo.min.js"></script>
<script src="js/vendor/jquery.color-2.1.2.min.js"></script>
<script src="js/vendor/jquery-deparam.js"></script>

<script src="js/utils.js"></script>
<script src="js/main.js"></script>

<script src="js/demo/regdomain.js"></script>
<script src="js/demo/alias_data.js"></script>
<script src="js/demo/country_data.js"></script>
<script src="js/demo/lang_data.js"></script>
<script src="js/demo/wikidata_data.js"></script>
<script src="js/demo/gpinfer.js"></script>
<script src="js/demo/_languageData.js"></script>
<script src="js/demo/guessLanguage.js"></script>

<script>
    var algDists = {};
    var onResults = function(results) {
        var name = results[0];
        var dist = results[1];
        var newText = '';
        if (dist.length) {
            dist = dist[1];
        }

        algDists[name] = dist;

        if (!dist || Object.keys(dist).length == 0) {
            newText = '<span class=error>No results found</span>\n';
        } else {
            var countries = Object.keys(dist).sort(function(a,b){return dist[b]-dist[a];})
            newText += '<span class=results>most likely countries:</span>\n';
            for (var i = 0; i < countries.length && i < 5; i++) {
                var c = countries[i];
                var p = dist[c];
                newText += ('<span class=results>' + c + ': ' + p + '</span>\n');
            }
        }

        var pre = $(".alg-" + name + " pre");
        pre.html(pre.html() + newText);
        pre.scrollTo('100%');

        showMap(name);
    };


    var mapColors = {
        final: 'rgb(41, 128, 185)',
        prior: 'rgb(192, 57, 43)',
        lang: 'rgb(39, 174, 96)',
        whois: 'rgb(211, 84, 0)',
        ip: 'rgb(230, 126, 34)',
        tld: 'rgb(142, 68, 173)',
        wikidata: 'rgb(241, 196, 15)'
    };

    var showMap = function(name) {
        $('div.alg').each(function (i, div) {
            div = $(div);
            var color = div.hasClass('alg-' + name) ? mapColors[name] : "#fff";
            div.animate({'border-color' : color}, 200);
        });

        var color = $.Color(mapColors[name]).toHexString();

        var dist = algDists[name] || {};
        var values = {};
        for (var c in dist) {
            if (c == 'uk') c = 'gb';
            values[c.toUpperCase()] = dist[c];
        }
        var config = {
            map: 'world_mill_en',
            series: {
                regions: [{
                    min: 0.0,
                    max: 1.0,
                    values: values,
                    scale: ['#FFFFFF', color],
                    normalizeFunction:  function(value) {
                        if (value < 0.003) return 0.0;
                        else return Math.pow(value, 0.2);
                    }
                }]
            },
            onRegionTipShow: function(e, el, code){
                $(".jvectormap-tip").filter(function (e) { return e != el; }).hide();
                el.html(el.html()+' ('+ (100 * values[code]).toFixed(2) +'%)');
            }
        };
        $('.map-container').empty().vectorMap(config);
    };

    var onError = function(results) {
        var name = results[0];
        var result = results[1];
        var pre = $(".alg-" + name + " pre");
        pre.html(pre.html() + '<span class=error>' + result + '</span>\n');
        pre.scrollTo('100%');
    };

    var onMessage = function(results) {
        var name = results[0];
        var result = results[1];
        var pre = $(".alg-" + name + " pre");
        pre.html(pre.html() + result + '\n');
        pre.scrollTo('100%');
    };

    $().ready(function () {
        $('.map-container').vectorMap({map: 'world_mill_en'});
        $(".loading-dialog").modal({'show' : 'true', 'backdrop' : 'static' });
        GP.init(
                'js/demo',
                function (caption, percent) {
                    var bar = $(".progress-bar[caption='" + caption + "']");
                    bar.width(percent + '%');
                    bar.text(caption + ': ' + (percent|0) + '%');
                },
                function () {
                    $(".loading-dialog").modal('hide');
                    pageInit();
                }
        );
    });

    var triggerUrl = function(url) {
        var form = $(".queryform form");
        form.find("input").val(url.trim());
        form.submit();
    };

    var pageInit = function () {
        GP.initShare();

        $.extend($.scrollTo.defaults, { axis: 'y' });
        $("a.example").click(function () {
            triggerUrl($(this).text().trim());
            return false;
        });
        $(".queryform form").submit(function () {
            $(".alg pre").html('');
            var url = $(this).find("input").val().trim();
            if (!url || url.indexOf('.') < 0) {
                alert('invalid url');
                return false;
            }
            if (url.length < 4 || url.substring(0, 4) != 'http') {
                url = 'http://' + url;
            }
            onMessage(['final','testing inferrence of url ' + url]);
            onMessage(['final','domain is ' + GP.getDomain(url)]);
            onMessage(['final', 'registered domain is ' + GP.getRegisteredDomain(url)]);
            GP.LogisticInferrer(url, onResults, onMessage, onError);
            return false;
        });
        $(".queryform button").click(function () {
            $(".queryform form").submit();
            return false;
        });

        $(".alg")
                .mouseenter(function () {
                    if (GP.mouseleavetimer) {
                        clearTimeout(GP.mouseleavetimer);
                    }
                    GP.mouseleavetimer = null;
                    var classes = $(this).attr('class').split(' ');
                    classes.forEach( function (c) {
                        if (c.substring(0, 4) == 'alg-') {
                            showMap(c.substring(4));
                        }
                    });
                }).mouseleave(function () {
                    GP.mouseleavetimer = setTimeout(
                            function () {
                                showMap('final');
                                GP.mouseleavetimer = null;
                            }, 200);
                });

        var query = GP.url2QueryObj(GP.location().href);
        if (query.url) {
            triggerUrl(query.url);
        }
    };
</script>

<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-61924569-1', 'auto');
    ga('send', 'pageview');

</script>
</body>
</html>
